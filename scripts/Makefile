# TTS Website Makefile
# ç®€åŒ–å¸¸ç”¨å‘½ä»¤

.PHONY: help build deploy quick-deploy test clean version

# é»˜è®¤ç›®æ ‡
help:
	@echo "TTS Website éƒ¨ç½²å‘½ä»¤"
	@echo ""
	@echo "å¯ç”¨å‘½ä»¤:"
	@echo "  make build         - ä»…æ„å»ºDockeré•œåƒ"
	@echo "  make deploy        - å®Œæ•´éƒ¨ç½²ï¼ˆæ„å»º+æ¨é€ï¼‰"
	@echo "  make quick-deploy  - å¿«é€Ÿéƒ¨ç½²"
	@echo "  make test          - æ„å»ºå¹¶æµ‹è¯•é•œåƒ"
	@echo "  make clean         - æ¸…ç†Dockeré•œåƒ"
	@echo "  make version       - æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬"
	@echo "  make bump-patch    - å¢åŠ è¡¥ä¸ç‰ˆæœ¬å·"
	@echo "  make bump-minor    - å¢åŠ æ¬¡ç‰ˆæœ¬å·"
	@echo "  make bump-major    - å¢åŠ ä¸»ç‰ˆæœ¬å·"
	@echo ""
	@echo "ç¤ºä¾‹:"
	@echo "  make deploy VERSION=v2.1.0"
	@echo "  make quick-deploy"

# æ„å»ºé•œåƒ
build:
	@echo "ğŸ”¨ æ„å»ºDockeré•œåƒ..."
	@chmod +x deploy.sh
	@./deploy.sh --build-only $(VERSION)

# å®Œæ•´éƒ¨ç½²
deploy:
	@echo "ğŸš€ å¼€å§‹å®Œæ•´éƒ¨ç½²..."
	@chmod +x deploy.sh
	@./deploy.sh $(VERSION)

# å¿«é€Ÿéƒ¨ç½²
quick-deploy:
	@echo "âš¡ å¿«é€Ÿéƒ¨ç½²..."
	@chmod +x quick-deploy.sh
	@./quick-deploy.sh $(VERSION)

# æ„å»ºå¹¶æµ‹è¯•
test:
	@echo "ğŸ§ª æ„å»ºå¹¶æµ‹è¯•é•œåƒ..."
	@chmod +x deploy.sh
	@./deploy.sh --test $(VERSION)

# æ¸…ç†é•œåƒ
clean:
	@echo "ğŸ§¹ æ¸…ç†Dockeré•œåƒ..."
	@docker image prune -f
	@docker images gwozai/tts-website --format "table {{.Repository}}\t{{.Tag}}\t{{.ID}}\t{{.CreatedAt}}\t{{.Size}}"

# ç‰ˆæœ¬ç®¡ç†
version:
	@chmod +x version.sh
	@./version.sh current

bump-patch:
	@chmod +x version.sh
	@./version.sh bump patch

bump-minor:
	@chmod +x version.sh
	@./version.sh bump minor

bump-major:
	@chmod +x version.sh
	@./version.sh bump major

# æœ¬åœ°å¼€å‘
dev:
	@echo "ğŸ”§ å¯åŠ¨æœ¬åœ°å¼€å‘ç¯å¢ƒ..."
	@cd ../docker && docker-compose up -d
	@echo "âœ… å¼€å‘ç¯å¢ƒå·²å¯åŠ¨: http://localhost:8080"

dev-stop:
	@echo "â¹ï¸  åœæ­¢å¼€å‘ç¯å¢ƒ..."
	@cd ../docker && docker-compose down

dev-logs:
	@echo "ğŸ“‹ æŸ¥çœ‹å¼€å‘ç¯å¢ƒæ—¥å¿—..."
	@cd ../docker && docker-compose logs -f

# å‘å¸ƒæµç¨‹ï¼ˆç‰ˆæœ¬ç®¡ç†+éƒ¨ç½²ï¼‰
release-patch: bump-patch deploy
release-minor: bump-minor deploy  
release-major: bump-major deploy

# å®‰è£…ä¾èµ–
install:
	@echo "ğŸ“¦ å®‰è£…Pythonä¾èµ–..."
	@pip install -r ../requirements.txt

# è¿è¡Œæœ¬åœ°åº”ç”¨
run:
	@echo "ğŸƒ å¯åŠ¨æœ¬åœ°åº”ç”¨..."
	@cd .. && python app.py
