# éƒ¨ç½²è„šæœ¬ä½¿ç”¨æŒ‡å—

æœ¬é¡¹ç›®æä¾›äº†å®Œæ•´çš„è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼Œè®©ä½ èƒ½å¤Ÿå¿«é€Ÿã€å¯é åœ°å°†é¡¹ç›®éƒ¨ç½²åˆ°Docker Hubã€‚

## ğŸ“ è„šæœ¬æ–‡ä»¶

- **`deploy.sh`** - å®Œæ•´çš„éƒ¨ç½²è„šæœ¬ï¼Œæ”¯æŒå¤šç§é€‰é¡¹
- **`quick-deploy.sh`** - ç®€åŒ–çš„å¿«é€Ÿéƒ¨ç½²è„šæœ¬
- **`version.sh`** - ç‰ˆæœ¬ç®¡ç†è„šæœ¬
- **`Makefile`** - ç®€åŒ–å‘½ä»¤çš„Makeæ–‡ä»¶
- **`deploy.config`** - éƒ¨ç½²é…ç½®æ–‡ä»¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼1ï¼šä½¿ç”¨Makeå‘½ä»¤ï¼ˆæ¨èï¼‰

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make help

# å¿«é€Ÿéƒ¨ç½²ï¼ˆæœ€ç®€å•ï¼‰
make quick-deploy

# å®Œæ•´éƒ¨ç½²
make deploy

# æ„å»ºå¹¶æµ‹è¯•
make test
```

### æ–¹å¼2ï¼šç›´æ¥ä½¿ç”¨è„šæœ¬

```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x *.sh

# å¿«é€Ÿéƒ¨ç½²
./quick-deploy.sh

# å®Œæ•´éƒ¨ç½²
./deploy.sh

# æŒ‡å®šç‰ˆæœ¬éƒ¨ç½²
./deploy.sh v2.1.0
```

## ğŸ“‹ è¯¦ç»†ä½¿ç”¨è¯´æ˜

### 1. å®Œæ•´éƒ¨ç½²è„šæœ¬ (deploy.sh)

è¿™æ˜¯åŠŸèƒ½æœ€å®Œæ•´çš„éƒ¨ç½²è„šæœ¬ï¼Œæ”¯æŒå¤šç§é€‰é¡¹ï¼š

```bash
# åŸºæœ¬ç”¨æ³•
./deploy.sh [é€‰é¡¹] [ç‰ˆæœ¬å·]

# å¸¸ç”¨é€‰é¡¹
./deploy.sh                    # è‡ªåŠ¨ç‰ˆæœ¬å·éƒ¨ç½²
./deploy.sh v2.1.0            # æŒ‡å®šç‰ˆæœ¬å·
./deploy.sh -t v2.1.0         # æ„å»ºã€æµ‹è¯•å¹¶éƒ¨ç½²
./deploy.sh -c                # éƒ¨ç½²åæ¸…ç†æœ¬åœ°é•œåƒ
./deploy.sh --build-only      # ä»…æ„å»ºï¼Œä¸æ¨é€
./deploy.sh --push-only       # ä»…æ¨é€ï¼ˆå‡è®¾é•œåƒå·²å­˜åœ¨ï¼‰
./deploy.sh --no-proxy        # ä¸ä½¿ç”¨ä»£ç†
```

**æ”¯æŒçš„é€‰é¡¹ï¼š**
- `-h, --help` - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- `-t, --test` - æ„å»ºåæµ‹è¯•é•œåƒ
- `-c, --cleanup` - æ¨é€åæ¸…ç†æœ¬åœ°é•œåƒ
- `--no-proxy` - ä¸ä½¿ç”¨ä»£ç†
- `--build-only` - ä»…æ„å»ºï¼Œä¸æ¨é€
- `--push-only` - ä»…æ¨é€

### 2. å¿«é€Ÿéƒ¨ç½²è„šæœ¬ (quick-deploy.sh)

ç®€åŒ–ç‰ˆæœ¬ï¼Œé€‚åˆæ—¥å¸¸å¿«é€Ÿéƒ¨ç½²ï¼š

```bash
# ä½¿ç”¨è‡ªåŠ¨ç‰ˆæœ¬å·
./quick-deploy.sh

# æŒ‡å®šç‰ˆæœ¬å·
./quick-deploy.sh v2.1.0

# ä¸ä½¿ç”¨ä»£ç†
USE_PROXY=false ./quick-deploy.sh
```

### 3. ç‰ˆæœ¬ç®¡ç†è„šæœ¬ (version.sh)

ç®¡ç†é¡¹ç›®ç‰ˆæœ¬å’Œæ›´æ–°æ—¥å¿—ï¼š

```bash
# æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
./version.sh current

# å¢åŠ ç‰ˆæœ¬å·
./version.sh bump patch    # 2.0.0 â†’ 2.0.1
./version.sh bump minor    # 2.0.1 â†’ 2.1.0
./version.sh bump major    # 2.1.0 â†’ 3.0.0

# è®¾ç½®æŒ‡å®šç‰ˆæœ¬
./version.sh set v2.5.0

# æ›´æ–°CHANGELOG
./version.sh changelog

# åˆ›å»ºGitæ ‡ç­¾
./version.sh tag
```

### 4. Makeå‘½ä»¤

æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ï¼š

```bash
# å¼€å‘ç›¸å…³
make dev           # å¯åŠ¨å¼€å‘ç¯å¢ƒ
make dev-stop      # åœæ­¢å¼€å‘ç¯å¢ƒ
make dev-logs      # æŸ¥çœ‹å¼€å‘æ—¥å¿—

# æ„å»ºå’Œéƒ¨ç½²
make build         # ä»…æ„å»º
make deploy        # å®Œæ•´éƒ¨ç½²
make quick-deploy  # å¿«é€Ÿéƒ¨ç½²
make test          # æ„å»ºå¹¶æµ‹è¯•

# ç‰ˆæœ¬ç®¡ç†
make version       # æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬
make bump-patch    # å¢åŠ è¡¥ä¸ç‰ˆæœ¬
make bump-minor    # å¢åŠ æ¬¡ç‰ˆæœ¬
make bump-major    # å¢åŠ ä¸»ç‰ˆæœ¬

# å‘å¸ƒæµç¨‹ï¼ˆç‰ˆæœ¬+éƒ¨ç½²ï¼‰
make release-patch # å¢åŠ è¡¥ä¸ç‰ˆæœ¬å¹¶éƒ¨ç½²
make release-minor # å¢åŠ æ¬¡ç‰ˆæœ¬å¹¶éƒ¨ç½²
make release-major # å¢åŠ ä¸»ç‰ˆæœ¬å¹¶éƒ¨ç½²

# æ¸…ç†
make clean         # æ¸…ç†Dockeré•œåƒ
```

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

```bash
# ä»£ç†è®¾ç½®
USE_PROXY=true          # æ˜¯å¦ä½¿ç”¨ä»£ç†
PROXY_HOST=127.0.0.1    # ä»£ç†ä¸»æœº
PROXY_PORT=7897         # ä»£ç†ç«¯å£

# æ„å»ºé€‰é¡¹
CLEANUP=true            # æ˜¯å¦æ¸…ç†é•œåƒ
TEST_IMAGE=true         # æ˜¯å¦æµ‹è¯•é•œåƒ
```

### é…ç½®æ–‡ä»¶ (deploy.config)

å¯ä»¥ä¿®æ”¹ `deploy.config` æ–‡ä»¶æ¥è‡ªå®šä¹‰é»˜è®¤è¡Œä¸ºï¼š

```bash
# Dockeré…ç½®
DOCKER_USERNAME="gwozai"
IMAGE_NAME="tts-website"

# ä»£ç†é…ç½®
USE_PROXY=true
PROXY_HOST="127.0.0.1"
PROXY_PORT="7897"

# å…¶ä»–é…ç½®...
```

## ğŸ”„ å…¸å‹å·¥ä½œæµç¨‹

### æ—¥å¸¸å¼€å‘éƒ¨ç½²

```bash
# 1. å¼€å‘å®Œæˆå
make quick-deploy

# æˆ–è€…
./quick-deploy.sh
```

### ç‰ˆæœ¬å‘å¸ƒæµç¨‹

```bash
# 1. å¢åŠ ç‰ˆæœ¬å·
make bump-minor

# 2. ç¼–è¾‘ doc/CHANGELOG.md æ·»åŠ å˜æ›´è¯´æ˜

# 3. éƒ¨ç½²
make deploy

# æˆ–è€…ä¸€æ­¥å®Œæˆ
make release-minor
```

### æµ‹è¯•éƒ¨ç½²

```bash
# æ„å»ºå¹¶æµ‹è¯•
make test

# æˆ–è€…
./deploy.sh -t
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æƒé™é”™è¯¯**
   ```bash
   chmod +x *.sh
   ```

2. **Dockeræœªè¿è¡Œ**
   ```bash
   # å¯åŠ¨Docker Desktop
   # æˆ–æ£€æŸ¥DockeræœåŠ¡çŠ¶æ€
   docker info
   ```

3. **ç½‘ç»œè¿æ¥é—®é¢˜**
   ```bash
   # æ£€æŸ¥ä»£ç†è®¾ç½®
   ./deploy.sh --no-proxy
   
   # æˆ–ä¿®æ”¹ä»£ç†é…ç½®
   export USE_PROXY=false
   ```

4. **Docker Hubç™»å½•é—®é¢˜**
   ```bash
   docker login -u gwozai
   ```

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹è¯¦ç»†è¾“å‡º
./deploy.sh -v

# æŸ¥çœ‹æ„å»ºæ—¥å¿—
docker build --progress=plain .
```

## ğŸ“ æœ€ä½³å®è·µ

1. **ä½¿ç”¨ç‰ˆæœ¬ç®¡ç†**
   - æ¯æ¬¡å‘å¸ƒå‰å…ˆæ›´æ–°ç‰ˆæœ¬å·
   - åŠæ—¶æ›´æ–°CHANGELOG.md

2. **æµ‹è¯•å…ˆè¡Œ**
   - é‡è¦æ›´æ–°ä½¿ç”¨ `make test` å…ˆæµ‹è¯•
   - æœ¬åœ°éªŒè¯åå†æ¨é€

3. **é…ç½®ç®¡ç†**
   - æ ¹æ®éœ€è¦è°ƒæ•´ `deploy.config`
   - ä½¿ç”¨ç¯å¢ƒå˜é‡è¦†ç›–é»˜è®¤é…ç½®

4. **è‡ªåŠ¨åŒ–æµç¨‹**
   - ä½¿ç”¨ `make release-*` å‘½ä»¤å®ç°ç‰ˆæœ¬+éƒ¨ç½²ä¸€æ­¥å®Œæˆ
   - é…ç½®Git hookså®ç°è‡ªåŠ¨éƒ¨ç½²

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Dockeréƒ¨ç½²æŒ‡å—](DOCKER_README.md)
- [ç¯å¢ƒå˜é‡é…ç½®](ENV_CONFIG.md)
- [æ›´æ–°æ—¥å¿—](CHANGELOG.md)
